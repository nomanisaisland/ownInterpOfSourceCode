{"ast":null,"code":"/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * \r\n */\nimport { REACT_PROVIDER_TYPE, REACT_SERVER_CONTEXT_TYPE, REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED } from 'shared/ReactSymbols';\nimport { enableServerContext } from 'shared/ReactFeatureFlags';\nimport ReactSharedInternals from 'shared/ReactSharedInternals';\nconst ContextRegistry = ReactSharedInternals.ContextRegistry;\nexport function createServerContext(globalName, defaultValue) {\n  if (!enableServerContext) {\n    throw new Error('Not implemented.');\n  }\n\n  let wasDefined = true;\n\n  if (!ContextRegistry[globalName]) {\n    wasDefined = false;\n    const context = {\n      $$typeof: REACT_SERVER_CONTEXT_TYPE,\n      // As a workaround to support multiple concurrent renderers, we categorize\n      // some renderers as primary and others as secondary. We only expect\n      // there to be two concurrent renderers at most: React Native (primary) and\n      // Fabric (secondary); React DOM (primary) and React ART (secondary).\n      // Secondary renderers store their context values on separate fields.\n      _currentValue: defaultValue,\n      _currentValue2: defaultValue,\n      _defaultValue: defaultValue,\n      // Used to track how many concurrent renderers this context currently\n      // supports within in a single renderer. Such as parallel server rendering.\n      _threadCount: 0,\n      // These are circular\n      Provider: null,\n      Consumer: null,\n      _globalName: globalName\n    };\n    context.Provider = {\n      $$typeof: REACT_PROVIDER_TYPE,\n      _context: context\n    };\n\n    if (__DEV__) {\n      let hasWarnedAboutUsingConsumer;\n      context._currentRenderer = null;\n      context._currentRenderer2 = null;\n      Object.defineProperties(context, {\n        Consumer: {\n          get() {\n            if (!hasWarnedAboutUsingConsumer) {\n              console.error('Consumer pattern is not supported by ReactServerContext');\n              hasWarnedAboutUsingConsumer = true;\n            }\n\n            return null;\n          }\n\n        }\n      });\n    }\n\n    ContextRegistry[globalName] = context;\n  }\n\n  const context = ContextRegistry[globalName];\n\n  if (context._defaultValue === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\n    context._defaultValue = defaultValue;\n\n    if (context._currentValue === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\n      context._currentValue = defaultValue;\n    }\n\n    if (context._currentValue2 === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\n      context._currentValue2 = defaultValue;\n    }\n  } else if (wasDefined) {\n    throw new Error(`ServerContext: ${globalName} already defined`);\n  }\n\n  return context;\n}","map":{"version":3,"names":["REACT_PROVIDER_TYPE","REACT_SERVER_CONTEXT_TYPE","REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED","enableServerContext","ReactSharedInternals","ContextRegistry","createServerContext","globalName","defaultValue","Error","wasDefined","context","$$typeof","_currentValue","_currentValue2","_defaultValue","_threadCount","Provider","Consumer","_globalName","_context","__DEV__","hasWarnedAboutUsingConsumer","_currentRenderer","_currentRenderer2","Object","defineProperties","get","console","error"],"sources":["D:/project/font-end/debug-anything/react-test/src/react/packages/react/src/ReactServerContext.js"],"sourcesContent":["/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * @flow\r\n */\r\n\r\nimport {\r\n  REACT_PROVIDER_TYPE,\r\n  REACT_SERVER_CONTEXT_TYPE,\r\n  REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED,\r\n} from 'shared/ReactSymbols';\r\n\r\nimport type {\r\n  ReactServerContext,\r\n  ServerContextJSONValue,\r\n} from 'shared/ReactTypes';\r\n\r\nimport {enableServerContext} from 'shared/ReactFeatureFlags';\r\nimport ReactSharedInternals from 'shared/ReactSharedInternals';\r\n\r\nconst ContextRegistry = ReactSharedInternals.ContextRegistry;\r\n\r\nexport function createServerContext<T: ServerContextJSONValue>(\r\n  globalName: string,\r\n  defaultValue: T,\r\n): ReactServerContext<T> {\r\n  if (!enableServerContext) {\r\n    throw new Error('Not implemented.');\r\n  }\r\n  let wasDefined = true;\r\n  if (!ContextRegistry[globalName]) {\r\n    wasDefined = false;\r\n    const context: ReactServerContext<T> = {\r\n      $$typeof: REACT_SERVER_CONTEXT_TYPE,\r\n\r\n      // As a workaround to support multiple concurrent renderers, we categorize\r\n      // some renderers as primary and others as secondary. We only expect\r\n      // there to be two concurrent renderers at most: React Native (primary) and\r\n      // Fabric (secondary); React DOM (primary) and React ART (secondary).\r\n      // Secondary renderers store their context values on separate fields.\r\n      _currentValue: defaultValue,\r\n      _currentValue2: defaultValue,\r\n\r\n      _defaultValue: defaultValue,\r\n\r\n      // Used to track how many concurrent renderers this context currently\r\n      // supports within in a single renderer. Such as parallel server rendering.\r\n      _threadCount: 0,\r\n      // These are circular\r\n      Provider: (null: any),\r\n      Consumer: (null: any),\r\n      _globalName: globalName,\r\n    };\r\n\r\n    context.Provider = {\r\n      $$typeof: REACT_PROVIDER_TYPE,\r\n      _context: context,\r\n    };\r\n\r\n    if (__DEV__) {\r\n      let hasWarnedAboutUsingConsumer;\r\n      context._currentRenderer = null;\r\n      context._currentRenderer2 = null;\r\n      Object.defineProperties(\r\n        context,\r\n        ({\r\n          Consumer: {\r\n            get() {\r\n              if (!hasWarnedAboutUsingConsumer) {\r\n                console.error(\r\n                  'Consumer pattern is not supported by ReactServerContext',\r\n                );\r\n                hasWarnedAboutUsingConsumer = true;\r\n              }\r\n              return null;\r\n            },\r\n          },\r\n        }: any),\r\n      );\r\n    }\r\n    ContextRegistry[globalName] = context;\r\n  }\r\n\r\n  const context = ContextRegistry[globalName];\r\n  if (context._defaultValue === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\r\n    context._defaultValue = defaultValue;\r\n    if (\r\n      context._currentValue === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED\r\n    ) {\r\n      context._currentValue = defaultValue;\r\n    }\r\n    if (\r\n      context._currentValue2 === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED\r\n    ) {\r\n      context._currentValue2 = defaultValue;\r\n    }\r\n  } else if (wasDefined) {\r\n    throw new Error(`ServerContext: ${globalName} already defined`);\r\n  }\r\n  return context;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,SACEA,mBADF,EAEEC,yBAFF,EAGEC,6CAHF,QAIO,qBAJP;AAWA,SAAQC,mBAAR,QAAkC,0BAAlC;AACA,OAAOC,oBAAP,MAAiC,6BAAjC;AAEA,MAAMC,eAAe,GAAGD,oBAAoB,CAACC,eAA7C;AAEA,OAAO,SAASC,mBAAT,CACLC,UADK,EAELC,YAFK,EAGkB;EACvB,IAAI,CAACL,mBAAL,EAA0B;IACxB,MAAM,IAAIM,KAAJ,CAAU,kBAAV,CAAN;EACD;;EACD,IAAIC,UAAU,GAAG,IAAjB;;EACA,IAAI,CAACL,eAAe,CAACE,UAAD,CAApB,EAAkC;IAChCG,UAAU,GAAG,KAAb;IACA,MAAMC,OAA8B,GAAG;MACrCC,QAAQ,EAAEX,yBAD2B;MAGrC;MACA;MACA;MACA;MACA;MACAY,aAAa,EAAEL,YARsB;MASrCM,cAAc,EAAEN,YATqB;MAWrCO,aAAa,EAAEP,YAXsB;MAarC;MACA;MACAQ,YAAY,EAAE,CAfuB;MAgBrC;MACAC,QAAQ,EAAG,IAjB0B;MAkBrCC,QAAQ,EAAG,IAlB0B;MAmBrCC,WAAW,EAAEZ;IAnBwB,CAAvC;IAsBAI,OAAO,CAACM,QAAR,GAAmB;MACjBL,QAAQ,EAAEZ,mBADO;MAEjBoB,QAAQ,EAAET;IAFO,CAAnB;;IAKA,IAAIU,OAAJ,EAAa;MACX,IAAIC,2BAAJ;MACAX,OAAO,CAACY,gBAAR,GAA2B,IAA3B;MACAZ,OAAO,CAACa,iBAAR,GAA4B,IAA5B;MACAC,MAAM,CAACC,gBAAP,CACEf,OADF,EAEG;QACCO,QAAQ,EAAE;UACRS,GAAG,GAAG;YACJ,IAAI,CAACL,2BAAL,EAAkC;cAChCM,OAAO,CAACC,KAAR,CACE,yDADF;cAGAP,2BAA2B,GAAG,IAA9B;YACD;;YACD,OAAO,IAAP;UACD;;QATO;MADX,CAFH;IAgBD;;IACDjB,eAAe,CAACE,UAAD,CAAf,GAA8BI,OAA9B;EACD;;EAED,MAAMA,OAAO,GAAGN,eAAe,CAACE,UAAD,CAA/B;;EACA,IAAII,OAAO,CAACI,aAAR,KAA0Bb,6CAA9B,EAA6E;IAC3ES,OAAO,CAACI,aAAR,GAAwBP,YAAxB;;IACA,IACEG,OAAO,CAACE,aAAR,KAA0BX,6CAD5B,EAEE;MACAS,OAAO,CAACE,aAAR,GAAwBL,YAAxB;IACD;;IACD,IACEG,OAAO,CAACG,cAAR,KAA2BZ,6CAD7B,EAEE;MACAS,OAAO,CAACG,cAAR,GAAyBN,YAAzB;IACD;EACF,CAZD,MAYO,IAAIE,UAAJ,EAAgB;IACrB,MAAM,IAAID,KAAJ,CAAW,kBAAiBF,UAAW,kBAAvC,CAAN;EACD;;EACD,OAAOI,OAAP;AACD"},"metadata":{},"sourceType":"module"}