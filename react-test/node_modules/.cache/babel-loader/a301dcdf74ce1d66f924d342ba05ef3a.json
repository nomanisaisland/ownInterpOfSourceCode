{"ast":null,"code":"/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * \r\n */\nimport { enableCache } from 'shared/ReactFeatureFlags';\nimport { REACT_CONTEXT_TYPE } from 'shared/ReactSymbols';\nimport { pushProvider, popProvider } from './ReactFiberNewContext.old';\nimport * as Scheduler from 'scheduler'; // In environments without AbortController (e.g. tests)\n// replace it with a lightweight shim that only has the features we use.\n\nconst AbortControllerLocal = enableCache ? typeof AbortController !== 'undefined' ? AbortController : function AbortControllerShim() {\n  const listeners = [];\n  const signal = this.signal = {\n    aborted: false,\n    addEventListener: (type, listener) => {\n      listeners.push(listener);\n    }\n  };\n\n  this.abort = () => {\n    signal.aborted = true;\n    listeners.forEach(listener => listener());\n  };\n} : null;\n// Intentionally not named imports because Rollup would\n// use dynamic dispatch for CommonJS interop named imports.\nconst {\n  unstable_scheduleCallback: scheduleCallback,\n  unstable_NormalPriority: NormalPriority\n} = Scheduler;\nexport const CacheContext = enableCache ? {\n  $$typeof: REACT_CONTEXT_TYPE,\n  // We don't use Consumer/Provider for Cache components. So we'll cheat.\n  Consumer: null,\n  Provider: null,\n  // We'll initialize these at the root.\n  _currentValue: null,\n  _currentValue2: null,\n  _threadCount: 0,\n  _defaultValue: null,\n  _globalName: null\n} : null;\n\nif (__DEV__ && enableCache) {\n  CacheContext._currentRenderer = null;\n  CacheContext._currentRenderer2 = null;\n} // Creates a new empty Cache instance with a ref-count of 0. The caller is responsible\n// for retaining the cache once it is in use (retainCache), and releasing the cache\n// once it is no longer needed (releaseCache).\n\n\nexport function createCache() {\n  if (!enableCache) {\n    return null;\n  }\n\n  const cache = {\n    controller: new AbortControllerLocal(),\n    data: new Map(),\n    refCount: 0\n  };\n  return cache;\n}\nexport function retainCache(cache) {\n  if (!enableCache) {\n    return;\n  }\n\n  if (__DEV__) {\n    if (cache.controller.signal.aborted) {\n      console.warn('A cache instance was retained after it was already freed. ' + 'This likely indicates a bug in React.');\n    }\n  }\n\n  console.log(cache, \"cachecachecachecache\");\n  cache.refCount++;\n} // Cleanup a cache instance, potentially freeing it if there are no more references\n\nexport function releaseCache(cache) {\n  if (!enableCache) {\n    return;\n  }\n\n  cache.refCount--;\n\n  if (__DEV__) {\n    if (cache.refCount < 0) {\n      console.warn('A cache instance was released after it was already freed. ' + 'This likely indicates a bug in React.');\n    }\n  }\n\n  if (cache.refCount === 0) {\n    scheduleCallback(NormalPriority, () => {\n      cache.controller.abort();\n    });\n  }\n}\nexport function pushCacheProvider(workInProgress, cache) {\n  if (!enableCache) {\n    return;\n  }\n\n  pushProvider(workInProgress, CacheContext, cache);\n}\nexport function popCacheProvider(workInProgress, cache) {\n  if (!enableCache) {\n    return;\n  }\n\n  popProvider(CacheContext, workInProgress);\n}","map":{"version":3,"names":["enableCache","REACT_CONTEXT_TYPE","pushProvider","popProvider","Scheduler","AbortControllerLocal","AbortController","AbortControllerShim","listeners","signal","aborted","addEventListener","type","listener","push","abort","forEach","unstable_scheduleCallback","scheduleCallback","unstable_NormalPriority","NormalPriority","CacheContext","$$typeof","Consumer","Provider","_currentValue","_currentValue2","_threadCount","_defaultValue","_globalName","__DEV__","_currentRenderer","_currentRenderer2","createCache","cache","controller","data","Map","refCount","retainCache","console","warn","log","releaseCache","pushCacheProvider","workInProgress","popCacheProvider"],"sources":["D:/project/font-end/debug-anything/react-test/src/react/packages/react-reconciler/src/ReactFiberCacheComponent.old.js"],"sourcesContent":["/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * @flow\r\n */\r\n\r\nimport type {ReactContext} from 'shared/ReactTypes';\r\n\r\nimport {enableCache} from 'shared/ReactFeatureFlags';\r\nimport {REACT_CONTEXT_TYPE} from 'shared/ReactSymbols';\r\n\r\nimport {pushProvider, popProvider} from './ReactFiberNewContext.old';\r\nimport * as Scheduler from 'scheduler';\r\n\r\n// In environments without AbortController (e.g. tests)\r\n// replace it with a lightweight shim that only has the features we use.\r\nconst AbortControllerLocal = enableCache\r\n  ? typeof AbortController !== 'undefined'\r\n    ? AbortController\r\n    : (function AbortControllerShim() {\r\n        const listeners = [];\r\n        const signal = (this.signal = {\r\n          aborted: false,\r\n          addEventListener: (type, listener) => {\r\n            listeners.push(listener);\r\n          },\r\n        });\r\n\r\n        this.abort = () => {\r\n          signal.aborted = true;\r\n          listeners.forEach(listener => listener());\r\n        };\r\n      }: AbortController)\r\n  : (null: any);\r\n\r\nexport type Cache = {|\r\n  controller: AbortControllerLocal,\r\n  data: Map<() => mixed, mixed>,\r\n  refCount: number,\r\n|};\r\n\r\nexport type CacheComponentState = {|\r\n  +parent: Cache,\r\n  +cache: Cache,\r\n|};\r\n\r\nexport type SpawnedCachePool = {|\r\n  +parent: Cache,\r\n  +pool: Cache,\r\n|};\r\n\r\n// Intentionally not named imports because Rollup would\r\n// use dynamic dispatch for CommonJS interop named imports.\r\nconst {\r\n  unstable_scheduleCallback: scheduleCallback,\r\n  unstable_NormalPriority: NormalPriority,\r\n} = Scheduler;\r\n\r\nexport const CacheContext: ReactContext<Cache> = enableCache\r\n  ? {\r\n      $$typeof: REACT_CONTEXT_TYPE,\r\n      // We don't use Consumer/Provider for Cache components. So we'll cheat.\r\n      Consumer: (null: any),\r\n      Provider: (null: any),\r\n      // We'll initialize these at the root.\r\n      _currentValue: (null: any),\r\n      _currentValue2: (null: any),\r\n      _threadCount: 0,\r\n      _defaultValue: (null: any),\r\n      _globalName: (null: any),\r\n    }\r\n  : (null: any);\r\n\r\nif (__DEV__ && enableCache) {\r\n  CacheContext._currentRenderer = null;\r\n  CacheContext._currentRenderer2 = null;\r\n}\r\n\r\n// Creates a new empty Cache instance with a ref-count of 0. The caller is responsible\r\n// for retaining the cache once it is in use (retainCache), and releasing the cache\r\n// once it is no longer needed (releaseCache).\r\nexport function createCache(): Cache {\r\n  if (!enableCache) {\r\n    return (null: any);\r\n  }\r\n  const cache: Cache = {\r\n    controller: new AbortControllerLocal(),\r\n    data: new Map(),\r\n    refCount: 0,\r\n  };\r\n\r\n  return cache;\r\n}\r\n\r\nexport function retainCache(cache: Cache) {\r\n  if (!enableCache) {\r\n    return;\r\n  }\r\n  if (__DEV__) {\r\n    if (cache.controller.signal.aborted) {\r\n      console.warn(\r\n        'A cache instance was retained after it was already freed. ' +\r\n          'This likely indicates a bug in React.',\r\n      );\r\n    }\r\n  }\r\n  console.log(cache,\"cachecachecachecache\")\r\n  cache.refCount++;\r\n}\r\n\r\n// Cleanup a cache instance, potentially freeing it if there are no more references\r\nexport function releaseCache(cache: Cache) {\r\n  if (!enableCache) {\r\n    return;\r\n  }\r\n  cache.refCount--;\r\n  if (__DEV__) {\r\n    if (cache.refCount < 0) {\r\n      console.warn(\r\n        'A cache instance was released after it was already freed. ' +\r\n          'This likely indicates a bug in React.',\r\n      );\r\n    }\r\n  }\r\n  if (cache.refCount === 0) {\r\n    scheduleCallback(NormalPriority, () => {\r\n      cache.controller.abort();\r\n    });\r\n  }\r\n}\r\n\r\nexport function pushCacheProvider(workInProgress: Fiber, cache: Cache) {\r\n  if (!enableCache) {\r\n    return;\r\n  }\r\n  pushProvider(workInProgress, CacheContext, cache);\r\n}\r\n\r\nexport function popCacheProvider(workInProgress: Fiber, cache: Cache) {\r\n  if (!enableCache) {\r\n    return;\r\n  }\r\n  popProvider(CacheContext, workInProgress);\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}