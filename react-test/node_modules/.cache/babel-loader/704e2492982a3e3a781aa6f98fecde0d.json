{"ast":null,"code":"/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * \r\n */\nimport { queueExplicitHydrationTarget } from '../events/ReactDOMEventReplaying';\nimport { REACT_ELEMENT_TYPE } from 'shared/ReactSymbols';\nimport { isContainerMarkedAsRoot, markContainerAsRoot, unmarkContainerAsRoot } from './ReactDOMComponentTree';\nimport { listenToAllSupportedEvents } from '../events/DOMPluginEventSystem';\nimport { ELEMENT_NODE, COMMENT_NODE, DOCUMENT_NODE, DOCUMENT_FRAGMENT_NODE } from '../shared/HTMLNodeType';\nimport { createContainer, createHydrationContainer, updateContainer, findHostInstanceWithNoPortals, registerMutableSourceForHydration, flushSync, isAlreadyRendering } from 'react-reconciler/src/ReactFiberReconciler';\nimport { ConcurrentRoot } from 'react-reconciler/src/ReactRootTags';\nimport { allowConcurrentByDefault, disableCommentsAsDOMContainers } from 'shared/ReactFeatureFlags';\n/* global reportError */\n\nconst defaultOnRecoverableError = typeof reportError === 'function' ? // In modern browsers, reportError will dispatch an error event,\n// emulating an uncaught JavaScript error.\nreportError : error => {\n  // In older browsers and test environments, fallback to console.error.\n  // eslint-disable-next-line react-internal/no-production-logging\n  console['error'](error);\n};\n\nfunction ReactDOMRoot(internalRoot) {\n  this._internalRoot = internalRoot;\n}\n\n_c = ReactDOMRoot;\n\nReactDOMHydrationRoot.prototype.render = ReactDOMRoot.prototype.render = function (children) {\n  const root = this._internalRoot;\n\n  if (root === null) {\n    throw new Error('Cannot update an unmounted root.');\n  }\n\n  if (__DEV__) {\n    if (typeof arguments[1] === 'function') {\n      console.error('render(...): does not support the second callback argument. ' + 'To execute a side effect after rendering, declare it in a component body with useEffect().');\n    } else if (isValidContainer(arguments[1])) {\n      console.error('You passed a container to the second argument of root.render(...). ' + \"You don't need to pass it again since you already passed it to create the root.\");\n    } else if (typeof arguments[1] !== 'undefined') {\n      console.error('You passed a second argument to root.render(...) but it only accepts ' + 'one argument.');\n    }\n\n    const container = root.containerInfo;\n\n    if (container.nodeType !== COMMENT_NODE) {\n      const hostInstance = findHostInstanceWithNoPortals(root.current);\n\n      if (hostInstance) {\n        if (hostInstance.parentNode !== container) {\n          console.error('render(...): It looks like the React-rendered content of the ' + 'root container was removed without using React. This is not ' + 'supported and will cause errors. Instead, call ' + \"root.unmount() to empty a root's container.\");\n        }\n      }\n    }\n  }\n\n  updateContainer(children, root, null, null);\n};\n\nReactDOMHydrationRoot.prototype.unmount = ReactDOMRoot.prototype.unmount = function () {\n  if (__DEV__) {\n    if (typeof arguments[0] === 'function') {\n      console.error('unmount(...): does not support a callback argument. ' + 'To execute a side effect after rendering, declare it in a component body with useEffect().');\n    }\n  }\n\n  const root = this._internalRoot;\n\n  if (root !== null) {\n    this._internalRoot = null;\n    const container = root.containerInfo;\n\n    if (__DEV__) {\n      if (isAlreadyRendering()) {\n        console.error('Attempted to synchronously unmount a root while React was already ' + 'rendering. React cannot finish unmounting the root until the ' + 'current render has completed, which may lead to a race condition.');\n      }\n    }\n\n    flushSync(() => {\n      updateContainer(null, root, null, null);\n    });\n    unmarkContainerAsRoot(container);\n  }\n};\n\nexport function createRoot(container, options) {\n  // console.log({ container, options }, \"传入container根节点和可选的options配置对象\");\n  // console.log(\"校验container是否符合根节点特性\")\n  if (!isValidContainer(container)) {\n    throw new Error('createRoot(...): Target container is not a DOM element.');\n  } // 为一些开发环境的用户操作做警告\n  // console.log(\"为开发者环境做一些警告: 1. 不能直接以body作为根节点. 2. 不能以同一个dom节点创建多个根节点\")\n\n\n  warnIfReactDOMContainerInDEV(container);\n  let isStrictMode = false;\n  let concurrentUpdatesByDefaultOverride = false;\n  let identifierPrefix = '';\n  let onRecoverableError = defaultOnRecoverableError;\n  let transitionCallbacks = null; // console.log({\n  //   isStrictMode,\n  //   concurrentUpdatesByDefaultOverride,\n  //   identifierPrefix,\n  //   onRecoverableError,\n  //   transitionCallbacks\n  // }, \"初始化一些必要的属性\")\n\n  if (options !== null && options !== undefined) {\n    if (__DEV__) {\n      // console.log({ hydrate: (options: any).hydrate }, \"如果配置属性有hydrate字段，则提示需要用ReactDOMClient.hydrateRoot方法，不可以用createRoot方法创建服务端渲染DOM\")\n      if (options.hydrate) {\n        console.warn('hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead.');\n      } else {\n        if (typeof options === 'object' && options !== null && options.$$typeof === REACT_ELEMENT_TYPE) {\n          // console.log(options, \"如果(options: any).$$typeof的类型是react.element(react 文档)则报错，因为创建根节点需要dom节点\")\n          //  (options: any).$$typeof === REACT_ELEMENT_TYPE （$$typeof表示配置属性的类型）\n          console.error('You passed a JSX element to createRoot. You probably meant to ' + 'call root.render instead. ' + 'Example usage:\\n\\n' + '  let root = createRoot(domContainer);\\n' + '  root.render(<App />);');\n        }\n      }\n    } // TODO options参数的作用\n\n\n    if (options.unstable_strictMode === true) {\n      isStrictMode = true;\n    }\n\n    if (allowConcurrentByDefault && options.unstable_concurrentUpdatesByDefault === true) {\n      concurrentUpdatesByDefaultOverride = true;\n    }\n\n    if (options.identifierPrefix !== undefined) {\n      identifierPrefix = options.identifierPrefix;\n    }\n\n    if (options.onRecoverableError !== undefined) {\n      onRecoverableError = options.onRecoverableError;\n    }\n\n    if (options.transitionCallbacks !== undefined) {\n      transitionCallbacks = options.transitionCallbacks;\n    } // console.log({\n    //   options: options,\n    //   new: {\n    //     isStrictMode,\n    //     allowConcurrentByDefault,\n    //     concurrentUpdatesByDefaultOverride,\n    //     identifierPrefix,\n    //     onRecoverableError,\n    //     transitionCallbacks\n    //   }\n    // }, \"将配置取出，并用函数作用域内的变量接收,为的是给参数提供默认值\")\n\n  } // console.log({\n  //   container,\n  //   ConcurrentRoot,\n  //   \"null\": null,\n  //   isStrictMode,\n  //   concurrentUpdatesByDefaultOverride,\n  //   identifierPrefix,\n  //   onRecoverableError,\n  //   transitionCallbacks,\n  // }, \"往createContainer内传递参数\");\n  // 获取fiberRoot 和rootFiber，以及他们的关系\n\n\n  const root = createContainer(container, ConcurrentRoot, null, isStrictMode, concurrentUpdatesByDefaultOverride, identifierPrefix, onRecoverableError, transitionCallbacks); // markContainerAsRoot 将fiberRoot绑定到根节点的属性上去\n\n  markContainerAsRoot(root.current, container); // console.log(COMMENT_NODE, container.nodeType, \"COMMENT_NODE 代表当前nodeType是一个注释\")\n\n  const rootContainerElement = container.nodeType === COMMENT_NODE ? container.parentNode : container; // 监听所有支持的事件\n\n  console.log(rootContainerElement);\n  listenToAllSupportedEvents(rootContainerElement);\n  return new ReactDOMRoot(root);\n}\n\nfunction ReactDOMHydrationRoot(internalRoot) {\n  this._internalRoot = internalRoot;\n}\n\n_c2 = ReactDOMHydrationRoot;\n\nfunction scheduleHydration(target) {\n  if (target) {\n    queueExplicitHydrationTarget(target);\n  }\n}\n\nReactDOMHydrationRoot.prototype.unstable_scheduleHydration = scheduleHydration;\nexport function hydrateRoot(container, initialChildren, options) {\n  if (!isValidContainer(container)) {\n    throw new Error('hydrateRoot(...): Target container is not a DOM element.');\n  }\n\n  warnIfReactDOMContainerInDEV(container);\n\n  if (__DEV__) {\n    if (initialChildren === undefined) {\n      console.error('Must provide initial children as second argument to hydrateRoot. ' + 'Example usage: hydrateRoot(domContainer, <App />)');\n    }\n  } // For now we reuse the whole bag of options since they contain\n  // the hydration callbacks.\n\n\n  const hydrationCallbacks = options != null ? options : null; // TODO: Delete this option\n\n  const mutableSources = options != null && options.hydratedSources || null;\n  let isStrictMode = false;\n  let concurrentUpdatesByDefaultOverride = false;\n  let identifierPrefix = '';\n  let onRecoverableError = defaultOnRecoverableError;\n\n  if (options !== null && options !== undefined) {\n    if (options.unstable_strictMode === true) {\n      isStrictMode = true;\n    }\n\n    if (allowConcurrentByDefault && options.unstable_concurrentUpdatesByDefault === true) {\n      concurrentUpdatesByDefaultOverride = true;\n    }\n\n    if (options.identifierPrefix !== undefined) {\n      identifierPrefix = options.identifierPrefix;\n    }\n\n    if (options.onRecoverableError !== undefined) {\n      onRecoverableError = options.onRecoverableError;\n    }\n  }\n\n  const root = createHydrationContainer(initialChildren, null, container, ConcurrentRoot, hydrationCallbacks, isStrictMode, concurrentUpdatesByDefaultOverride, identifierPrefix, onRecoverableError, // TODO(luna) Support hydration later\n  null);\n  markContainerAsRoot(root.current, container); // This can't be a comment node since hydration doesn't work on comment nodes anyway.\n\n  listenToAllSupportedEvents(container);\n\n  if (mutableSources) {\n    for (let i = 0; i < mutableSources.length; i++) {\n      const mutableSource = mutableSources[i];\n      registerMutableSourceForHydration(root, mutableSource);\n    }\n  }\n\n  return new ReactDOMHydrationRoot(root);\n}\n/**\r\n * @description 判断是否符合根节点要求\r\n * @param {*} node \r\n * @returns \r\n */\n\nexport function isValidContainer(node) {\n  // 对于文档节点来说，nodeValue返回null. 对于 text, comment，和 CDATA 节点来说，nodeValue 返回该节点的文本内容. 对于 attribute 节点来说，返回该属性的属性值。\n  // Comment 接口代表标签（markup）之间的文本符号（textual notations）。尽管它通常不会显示出来，但是在查看源码时可以看到它们。在 HTML 和 XML 里，注释（Comments）为 '<!--' 和 '-->' 之间的内容。在 XML 里，注释中不能出现字符序列 '--'。该接口没有特定的属性，但是从其父类 CharacterData 继承属性，以及间接从 Node 继承部分属性。\n  return !!(node && (node.nodeType === ELEMENT_NODE || node.nodeType === DOCUMENT_NODE || node.nodeType === DOCUMENT_FRAGMENT_NODE || !disableCommentsAsDOMContainers && node.nodeType === COMMENT_NODE && node.nodeValue === ' react-mount-point-unstable '));\n} // TODO: Remove this function which also includes comment nodes.\n// We only use it in places that are currently more relaxed.\n\nexport function isValidContainerLegacy(node) {\n  return !!(node && (node.nodeType === ELEMENT_NODE || node.nodeType === DOCUMENT_NODE || node.nodeType === DOCUMENT_FRAGMENT_NODE || node.nodeType === COMMENT_NODE && node.nodeValue === ' react-mount-point-unstable '));\n}\n\nfunction warnIfReactDOMContainerInDEV(container) {\n  if (__DEV__) {\n    // 不能直接将body标签作为根节点\n    if (container.nodeType === ELEMENT_NODE && container.tagName && container.tagName.toUpperCase() === 'BODY') {\n      console.error('createRoot(): Creating roots directly with document.body is ' + 'discouraged, since its children are often manipulated by third-party ' + 'scripts and browser extensions. This may lead to subtle ' + 'reconciliation issues. Try using a container element created ' + 'for your app.');\n    } // 判断是否有被创建过的痕迹\n\n\n    if (isContainerMarkedAsRoot(container)) {\n      // 如果有_reactRootContainer则代表已经被渲染过了，但是渲染在创建节点前执行是不支持的\n      if (container._reactRootContainer) {\n        console.error('You are calling ReactDOMClient.createRoot() on a container that was previously ' + 'passed to ReactDOM.render(). This is not supported.');\n      } else {\n        console.error('You are calling ReactDOMClient.createRoot() on a container that ' + 'has already been passed to createRoot() before. Instead, call ' + 'root.render() on the existing root instead if you want to update it.');\n      }\n    }\n  }\n}\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ReactDOMRoot\");\n$RefreshReg$(_c2, \"ReactDOMHydrationRoot\");","map":{"version":3,"names":["queueExplicitHydrationTarget","REACT_ELEMENT_TYPE","isContainerMarkedAsRoot","markContainerAsRoot","unmarkContainerAsRoot","listenToAllSupportedEvents","ELEMENT_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_FRAGMENT_NODE","createContainer","createHydrationContainer","updateContainer","findHostInstanceWithNoPortals","registerMutableSourceForHydration","flushSync","isAlreadyRendering","ConcurrentRoot","allowConcurrentByDefault","disableCommentsAsDOMContainers","defaultOnRecoverableError","reportError","error","console","ReactDOMRoot","internalRoot","_internalRoot","ReactDOMHydrationRoot","prototype","render","children","root","Error","__DEV__","arguments","isValidContainer","container","containerInfo","nodeType","hostInstance","current","parentNode","unmount","createRoot","options","warnIfReactDOMContainerInDEV","isStrictMode","concurrentUpdatesByDefaultOverride","identifierPrefix","onRecoverableError","transitionCallbacks","undefined","hydrate","warn","$$typeof","unstable_strictMode","unstable_concurrentUpdatesByDefault","rootContainerElement","log","scheduleHydration","target","unstable_scheduleHydration","hydrateRoot","initialChildren","hydrationCallbacks","mutableSources","hydratedSources","i","length","mutableSource","node","nodeValue","isValidContainerLegacy","tagName","toUpperCase","_reactRootContainer"],"sources":["D:/project/font-end/debug-anything/react-test/src/react/packages/react-dom/src/client/ReactDOMRoot.js"],"sourcesContent":["/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * @flow\r\n */\r\n\r\nimport type { MutableSource, ReactNodeList } from 'shared/ReactTypes';\r\nimport type {\r\n  FiberRoot,\r\n  TransitionTracingCallbacks,\r\n} from 'react-reconciler/src/ReactInternalTypes';\r\n\r\nimport { queueExplicitHydrationTarget } from '../events/ReactDOMEventReplaying';\r\nimport { REACT_ELEMENT_TYPE } from 'shared/ReactSymbols';\r\n\r\nexport type RootType = {\r\n  render (children: ReactNodeList): void,\r\n  unmount (): void,\r\n  _internalRoot: FiberRoot | null,\r\n  ...\r\n};\r\n\r\nexport type CreateRootOptions = {\r\n  unstable_strictMode?: boolean,\r\n  unstable_concurrentUpdatesByDefault?: boolean,\r\n  identifierPrefix?: string,\r\n  onRecoverableError?: (error: mixed) => void,\r\n  transitionCallbacks?: TransitionTracingCallbacks,\r\n  ...\r\n};\r\n\r\nexport type HydrateRootOptions = {\r\n  // Hydration options\r\n  hydratedSources?: Array<MutableSource<any>>,\r\n  onHydrated?: (suspenseNode: Comment) => void,\r\n  onDeleted?: (suspenseNode: Comment) => void,\r\n  // Options for all roots\r\n  unstable_strictMode?: boolean,\r\n  unstable_concurrentUpdatesByDefault?: boolean,\r\n  identifierPrefix?: string,\r\n  onRecoverableError?: (error: mixed) => void,\r\n  ...\r\n};\r\n\r\nimport {\r\n  isContainerMarkedAsRoot,\r\n  markContainerAsRoot,\r\n  unmarkContainerAsRoot,\r\n} from './ReactDOMComponentTree';\r\nimport { listenToAllSupportedEvents } from '../events/DOMPluginEventSystem';\r\nimport {\r\n  ELEMENT_NODE,\r\n  COMMENT_NODE,\r\n  DOCUMENT_NODE,\r\n  DOCUMENT_FRAGMENT_NODE,\r\n} from '../shared/HTMLNodeType';\r\n\r\nimport {\r\n  createContainer,\r\n  createHydrationContainer,\r\n  updateContainer,\r\n  findHostInstanceWithNoPortals,\r\n  registerMutableSourceForHydration,\r\n  flushSync,\r\n  isAlreadyRendering,\r\n} from 'react-reconciler/src/ReactFiberReconciler';\r\nimport { ConcurrentRoot } from 'react-reconciler/src/ReactRootTags';\r\nimport {\r\n  allowConcurrentByDefault,\r\n  disableCommentsAsDOMContainers,\r\n} from 'shared/ReactFeatureFlags';\r\n\r\n/* global reportError */\r\nconst defaultOnRecoverableError =\r\n  typeof reportError === 'function'\r\n    ? // In modern browsers, reportError will dispatch an error event,\r\n    // emulating an uncaught JavaScript error.\r\n    reportError\r\n    : (error: mixed) => {\r\n      // In older browsers and test environments, fallback to console.error.\r\n      // eslint-disable-next-line react-internal/no-production-logging\r\n      console['error'](error);\r\n    };\r\n\r\nfunction ReactDOMRoot (internalRoot: FiberRoot) {\r\n  this._internalRoot = internalRoot;\r\n}\r\n\r\nReactDOMHydrationRoot.prototype.render = ReactDOMRoot.prototype.render = function (\r\n  children: ReactNodeList,\r\n): void {\r\n  const root = this._internalRoot;\r\n  if (root === null) {\r\n    throw new Error('Cannot update an unmounted root.');\r\n  }\r\n\r\n  if (__DEV__) {\r\n    if (typeof arguments[1] === 'function') {\r\n      console.error(\r\n        'render(...): does not support the second callback argument. ' +\r\n        'To execute a side effect after rendering, declare it in a component body with useEffect().',\r\n      );\r\n    } else if (isValidContainer(arguments[1])) {\r\n      console.error(\r\n        'You passed a container to the second argument of root.render(...). ' +\r\n        \"You don't need to pass it again since you already passed it to create the root.\",\r\n      );\r\n    } else if (typeof arguments[1] !== 'undefined') {\r\n      console.error(\r\n        'You passed a second argument to root.render(...) but it only accepts ' +\r\n        'one argument.',\r\n      );\r\n    }\r\n\r\n    const container = root.containerInfo;\r\n\r\n    if (container.nodeType !== COMMENT_NODE) {\r\n      const hostInstance = findHostInstanceWithNoPortals(root.current);\r\n      if (hostInstance) {\r\n        if (hostInstance.parentNode !== container) {\r\n          console.error(\r\n            'render(...): It looks like the React-rendered content of the ' +\r\n            'root container was removed without using React. This is not ' +\r\n            'supported and will cause errors. Instead, call ' +\r\n            \"root.unmount() to empty a root's container.\",\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n  updateContainer(children, root, null, null);\r\n};\r\n\r\nReactDOMHydrationRoot.prototype.unmount = ReactDOMRoot.prototype.unmount = function (): void {\r\n  if (__DEV__) {\r\n    if (typeof arguments[0] === 'function') {\r\n      console.error(\r\n        'unmount(...): does not support a callback argument. ' +\r\n        'To execute a side effect after rendering, declare it in a component body with useEffect().',\r\n      );\r\n    }\r\n  }\r\n  const root = this._internalRoot;\r\n  if (root !== null) {\r\n    this._internalRoot = null;\r\n    const container = root.containerInfo;\r\n    if (__DEV__) {\r\n      if (isAlreadyRendering()) {\r\n        console.error(\r\n          'Attempted to synchronously unmount a root while React was already ' +\r\n          'rendering. React cannot finish unmounting the root until the ' +\r\n          'current render has completed, which may lead to a race condition.',\r\n        );\r\n      }\r\n    }\r\n    flushSync(() => {\r\n      updateContainer(null, root, null, null);\r\n    });\r\n    unmarkContainerAsRoot(container);\r\n  }\r\n};\r\n\r\nexport function createRoot (\r\n  container: Element | DocumentFragment,\r\n  options?: CreateRootOptions,\r\n): RootType {\r\n  // console.log({ container, options }, \"传入container根节点和可选的options配置对象\");\r\n  // console.log(\"校验container是否符合根节点特性\")\r\n  if (!isValidContainer(container)) {\r\n    throw new Error('createRoot(...): Target container is not a DOM element.');\r\n  }\r\n  // 为一些开发环境的用户操作做警告\r\n  // console.log(\"为开发者环境做一些警告: 1. 不能直接以body作为根节点. 2. 不能以同一个dom节点创建多个根节点\")\r\n  warnIfReactDOMContainerInDEV(container);\r\n\r\n  let isStrictMode = false;\r\n  let concurrentUpdatesByDefaultOverride = false;\r\n  let identifierPrefix = '';\r\n  let onRecoverableError = defaultOnRecoverableError;\r\n  let transitionCallbacks = null;\r\n  // console.log({\r\n  //   isStrictMode,\r\n  //   concurrentUpdatesByDefaultOverride,\r\n  //   identifierPrefix,\r\n  //   onRecoverableError,\r\n  //   transitionCallbacks\r\n  // }, \"初始化一些必要的属性\")\r\n\r\n  if (options !== null && options !== undefined) {\r\n    if (__DEV__) {\r\n\r\n      // console.log({ hydrate: (options: any).hydrate }, \"如果配置属性有hydrate字段，则提示需要用ReactDOMClient.hydrateRoot方法，不可以用createRoot方法创建服务端渲染DOM\")\r\n\r\n      if ((options: any).hydrate) {\r\n        console.warn(\r\n          'hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead.',\r\n        );\r\n      } else {\r\n        if (\r\n          typeof options === 'object' &&\r\n          options !== null &&\r\n          (options: any).$$typeof === REACT_ELEMENT_TYPE\r\n        ) {\r\n          // console.log(options, \"如果(options: any).$$typeof的类型是react.element(react 文档)则报错，因为创建根节点需要dom节点\")\r\n          //  (options: any).$$typeof === REACT_ELEMENT_TYPE （$$typeof表示配置属性的类型）\r\n          console.error(\r\n            'You passed a JSX element to createRoot. You probably meant to ' +\r\n            'call root.render instead. ' +\r\n            'Example usage:\\n\\n' +\r\n            '  let root = createRoot(domContainer);\\n' +\r\n            '  root.render(<App />);',\r\n          );\r\n        }\r\n      }\r\n    }\r\n    // TODO options参数的作用\r\n    if (options.unstable_strictMode === true) {\r\n      isStrictMode = true;\r\n    }\r\n    if (\r\n      allowConcurrentByDefault &&\r\n      options.unstable_concurrentUpdatesByDefault === true\r\n    ) {\r\n      concurrentUpdatesByDefaultOverride = true;\r\n    }\r\n    if (options.identifierPrefix !== undefined) {\r\n      identifierPrefix = options.identifierPrefix;\r\n    }\r\n    if (options.onRecoverableError !== undefined) {\r\n      onRecoverableError = options.onRecoverableError;\r\n    }\r\n    if (options.transitionCallbacks !== undefined) {\r\n      transitionCallbacks = options.transitionCallbacks;\r\n    }\r\n    // console.log({\r\n    //   options: options,\r\n    //   new: {\r\n    //     isStrictMode,\r\n    //     allowConcurrentByDefault,\r\n    //     concurrentUpdatesByDefaultOverride,\r\n    //     identifierPrefix,\r\n    //     onRecoverableError,\r\n    //     transitionCallbacks\r\n    //   }\r\n    // }, \"将配置取出，并用函数作用域内的变量接收,为的是给参数提供默认值\")\r\n  }\r\n\r\n  // console.log({\r\n  //   container,\r\n  //   ConcurrentRoot,\r\n  //   \"null\": null,\r\n  //   isStrictMode,\r\n  //   concurrentUpdatesByDefaultOverride,\r\n  //   identifierPrefix,\r\n  //   onRecoverableError,\r\n  //   transitionCallbacks,\r\n  // }, \"往createContainer内传递参数\");\r\n\r\n  // 获取fiberRoot 和rootFiber，以及他们的关系\r\n  const root = createContainer(\r\n    container,\r\n    ConcurrentRoot,\r\n    null,\r\n    isStrictMode,\r\n    concurrentUpdatesByDefaultOverride,\r\n    identifierPrefix,\r\n    onRecoverableError,\r\n    transitionCallbacks,\r\n  );\r\n  // markContainerAsRoot 将fiberRoot绑定到根节点的属性上去\r\n  markContainerAsRoot(root.current, container);\r\n\r\n  // console.log(COMMENT_NODE, container.nodeType, \"COMMENT_NODE 代表当前nodeType是一个注释\")\r\n  const rootContainerElement: Document | Element | DocumentFragment =\r\n    container.nodeType === COMMENT_NODE\r\n      ? (container.parentNode: any)\r\n      : container;\r\n\r\n  // 监听所有支持的事件\r\n  console.log(rootContainerElement)\r\n  listenToAllSupportedEvents(rootContainerElement);\r\n\r\n  return new ReactDOMRoot(root);\r\n}\r\n\r\nfunction ReactDOMHydrationRoot (internalRoot: FiberRoot) {\r\n  this._internalRoot = internalRoot;\r\n}\r\nfunction scheduleHydration (target: Node) {\r\n  if (target) {\r\n    queueExplicitHydrationTarget(target);\r\n  }\r\n}\r\nReactDOMHydrationRoot.prototype.unstable_scheduleHydration = scheduleHydration;\r\n\r\nexport function hydrateRoot (\r\n  container: Document | Element,\r\n  initialChildren: ReactNodeList,\r\n  options?: HydrateRootOptions,\r\n): RootType {\r\n  if (!isValidContainer(container)) {\r\n    throw new Error('hydrateRoot(...): Target container is not a DOM element.');\r\n  }\r\n\r\n  warnIfReactDOMContainerInDEV(container);\r\n\r\n  if (__DEV__) {\r\n    if (initialChildren === undefined) {\r\n      console.error(\r\n        'Must provide initial children as second argument to hydrateRoot. ' +\r\n        'Example usage: hydrateRoot(domContainer, <App />)',\r\n      );\r\n    }\r\n  }\r\n\r\n  // For now we reuse the whole bag of options since they contain\r\n  // the hydration callbacks.\r\n  const hydrationCallbacks = options != null ? options : null;\r\n  // TODO: Delete this option\r\n  const mutableSources = (options != null && options.hydratedSources) || null;\r\n\r\n  let isStrictMode = false;\r\n  let concurrentUpdatesByDefaultOverride = false;\r\n  let identifierPrefix = '';\r\n  let onRecoverableError = defaultOnRecoverableError;\r\n  if (options !== null && options !== undefined) {\r\n    if (options.unstable_strictMode === true) {\r\n      isStrictMode = true;\r\n    }\r\n    if (\r\n      allowConcurrentByDefault &&\r\n      options.unstable_concurrentUpdatesByDefault === true\r\n    ) {\r\n      concurrentUpdatesByDefaultOverride = true;\r\n    }\r\n    if (options.identifierPrefix !== undefined) {\r\n      identifierPrefix = options.identifierPrefix;\r\n    }\r\n    if (options.onRecoverableError !== undefined) {\r\n      onRecoverableError = options.onRecoverableError;\r\n    }\r\n  }\r\n\r\n  const root = createHydrationContainer(\r\n    initialChildren,\r\n    null,\r\n    container,\r\n    ConcurrentRoot,\r\n    hydrationCallbacks,\r\n    isStrictMode,\r\n    concurrentUpdatesByDefaultOverride,\r\n    identifierPrefix,\r\n    onRecoverableError,\r\n    // TODO(luna) Support hydration later\r\n    null,\r\n  );\r\n  markContainerAsRoot(root.current, container);\r\n  // This can't be a comment node since hydration doesn't work on comment nodes anyway.\r\n  listenToAllSupportedEvents(container);\r\n\r\n  if (mutableSources) {\r\n    for (let i = 0; i < mutableSources.length; i++) {\r\n      const mutableSource = mutableSources[i];\r\n      registerMutableSourceForHydration(root, mutableSource);\r\n    }\r\n  }\r\n\r\n  return new ReactDOMHydrationRoot(root);\r\n}\r\n\r\n/**\r\n * @description 判断是否符合根节点要求\r\n * @param {*} node \r\n * @returns \r\n */\r\nexport function isValidContainer (node: any): boolean {\r\n  // 对于文档节点来说，nodeValue返回null. 对于 text, comment，和 CDATA 节点来说，nodeValue 返回该节点的文本内容. 对于 attribute 节点来说，返回该属性的属性值。\r\n\r\n  // Comment 接口代表标签（markup）之间的文本符号（textual notations）。尽管它通常不会显示出来，但是在查看源码时可以看到它们。在 HTML 和 XML 里，注释（Comments）为 '<!--' 和 '-->' 之间的内容。在 XML 里，注释中不能出现字符序列 '--'。该接口没有特定的属性，但是从其父类 CharacterData 继承属性，以及间接从 Node 继承部分属性。\r\n\r\n  return !!(\r\n    node &&\r\n    (node.nodeType === ELEMENT_NODE ||\r\n      node.nodeType === DOCUMENT_NODE ||\r\n      node.nodeType === DOCUMENT_FRAGMENT_NODE ||\r\n      (!disableCommentsAsDOMContainers &&\r\n        node.nodeType === COMMENT_NODE &&\r\n        (node: any).nodeValue === ' react-mount-point-unstable '))\r\n  );\r\n}\r\n\r\n// TODO: Remove this function which also includes comment nodes.\r\n// We only use it in places that are currently more relaxed.\r\nexport function isValidContainerLegacy (node: any): boolean {\r\n  return !!(\r\n    node &&\r\n    (node.nodeType === ELEMENT_NODE ||\r\n      node.nodeType === DOCUMENT_NODE ||\r\n      node.nodeType === DOCUMENT_FRAGMENT_NODE ||\r\n      (node.nodeType === COMMENT_NODE &&\r\n        (node: any).nodeValue === ' react-mount-point-unstable '))\r\n  );\r\n}\r\n\r\nfunction warnIfReactDOMContainerInDEV (container: any) {\r\n  if (__DEV__) {\r\n    // 不能直接将body标签作为根节点\r\n    if (\r\n      container.nodeType === ELEMENT_NODE &&\r\n      ((container: any): Element).tagName &&\r\n      ((container: any): Element).tagName.toUpperCase() === 'BODY'\r\n    ) {\r\n      console.error(\r\n        'createRoot(): Creating roots directly with document.body is ' +\r\n        'discouraged, since its children are often manipulated by third-party ' +\r\n        'scripts and browser extensions. This may lead to subtle ' +\r\n        'reconciliation issues. Try using a container element created ' +\r\n        'for your app.',\r\n      );\r\n    }\r\n    // 判断是否有被创建过的痕迹\r\n    if (isContainerMarkedAsRoot(container)) {\r\n      // 如果有_reactRootContainer则代表已经被渲染过了，但是渲染在创建节点前执行是不支持的\r\n      if (container._reactRootContainer) {\r\n        console.error(\r\n          'You are calling ReactDOMClient.createRoot() on a container that was previously ' +\r\n          'passed to ReactDOM.render(). This is not supported.',\r\n        );\r\n      } else {\r\n        console.error(\r\n          'You are calling ReactDOMClient.createRoot() on a container that ' +\r\n          'has already been passed to createRoot() before. Instead, call ' +\r\n          'root.render() on the existing root instead if you want to update it.',\r\n        );\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}