{"ast":null,"code":"/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * \r\n */\nimport { checkFormFieldValueStringCoercion } from 'shared/CheckStringCoercion';\n\nfunction isCheckable(elem) {\n  const type = elem.type;\n  const nodeName = elem.nodeName;\n  return nodeName && nodeName.toLowerCase() === 'input' && (type === 'checkbox' || type === 'radio');\n}\n\nfunction getTracker(node) {\n  return node._valueTracker;\n}\n\nfunction detachTracker(node) {\n  node._valueTracker = null;\n}\n\nfunction getValueFromNode(node) {\n  let value = '';\n\n  if (!node) {\n    return value;\n  }\n\n  if (isCheckable(node)) {\n    value = node.checked ? 'true' : 'false';\n  } else {\n    value = node.value;\n  }\n\n  return value;\n}\n\nfunction trackValueOnNode(node) {\n  const valueField = isCheckable(node) ? 'checked' : 'value';\n  const descriptor = Object.getOwnPropertyDescriptor(node.constructor.prototype, valueField);\n\n  if (__DEV__) {\n    checkFormFieldValueStringCoercion(node[valueField]);\n  }\n\n  let currentValue = '' + node[valueField]; // if someone has already defined a value or Safari, then bail\n  // and don't track value will cause over reporting of changes,\n  // but it's better then a hard failure\n  // (needed for certain tests that spyOn input values and Safari)\n\n  if (node.hasOwnProperty(valueField) || typeof descriptor === 'undefined' || typeof descriptor.get !== 'function' || typeof descriptor.set !== 'function') {\n    return;\n  }\n\n  const {\n    get,\n    set\n  } = descriptor;\n  Object.defineProperty(node, valueField, {\n    configurable: true,\n    get: function () {\n      return get.call(this);\n    },\n    set: function (value) {\n      if (__DEV__) {\n        checkFormFieldValueStringCoercion(value);\n      }\n\n      currentValue = '' + value;\n      set.call(this, value);\n    }\n  }); // We could've passed this the first time\n  // but it triggers a bug in IE11 and Edge 14/15.\n  // Calling defineProperty() again should be equivalent.\n  // https://github.com/facebook/react/issues/11768\n\n  Object.defineProperty(node, valueField, {\n    enumerable: descriptor.enumerable\n  });\n  const tracker = {\n    getValue() {\n      return currentValue;\n    },\n\n    setValue(value) {\n      if (__DEV__) {\n        checkFormFieldValueStringCoercion(value);\n      }\n\n      currentValue = '' + value;\n    },\n\n    stopTracking() {\n      detachTracker(node);\n      delete node[valueField];\n    }\n\n  };\n  return tracker;\n}\n\nexport function track(node) {\n  if (getTracker(node)) {\n    return;\n  } // TODO: Once it's just Fiber we can move this to node._wrapperState\n\n\n  node._valueTracker = trackValueOnNode(node);\n}\nexport function updateValueIfChanged(node) {\n  if (!node) {\n    return false;\n  }\n\n  const tracker = getTracker(node); // if there is no tracker at this point it's unlikely\n  // that trying again will succeed\n\n  if (!tracker) {\n    return true;\n  }\n\n  const lastValue = tracker.getValue();\n  const nextValue = getValueFromNode(node);\n\n  if (nextValue !== lastValue) {\n    tracker.setValue(nextValue);\n    return true;\n  }\n\n  return false;\n}\nexport function stopTracking(node) {\n  const tracker = getTracker(node);\n\n  if (tracker) {\n    tracker.stopTracking();\n  }\n}","map":{"version":3,"names":["checkFormFieldValueStringCoercion","isCheckable","elem","type","nodeName","toLowerCase","getTracker","node","_valueTracker","detachTracker","getValueFromNode","value","checked","trackValueOnNode","valueField","descriptor","Object","getOwnPropertyDescriptor","constructor","prototype","__DEV__","currentValue","hasOwnProperty","get","set","defineProperty","configurable","call","enumerable","tracker","getValue","setValue","stopTracking","track","updateValueIfChanged","lastValue","nextValue"],"sources":["E:/react-test/src/react/packages/react-dom/src/client/inputValueTracking.js"],"sourcesContent":["/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * @flow\r\n */\r\n\r\nimport {checkFormFieldValueStringCoercion} from 'shared/CheckStringCoercion';\r\n\r\ntype ValueTracker = {|\r\n  getValue(): string,\r\n  setValue(value: string): void,\r\n  stopTracking(): void,\r\n|};\r\ntype WrapperState = {_valueTracker?: ?ValueTracker, ...};\r\ntype ElementWithValueTracker = HTMLInputElement & WrapperState;\r\n\r\nfunction isCheckable(elem: HTMLInputElement) {\r\n  const type = elem.type;\r\n  const nodeName = elem.nodeName;\r\n  return (\r\n    nodeName &&\r\n    nodeName.toLowerCase() === 'input' &&\r\n    (type === 'checkbox' || type === 'radio')\r\n  );\r\n}\r\n\r\nfunction getTracker(node: ElementWithValueTracker) {\r\n  return node._valueTracker;\r\n}\r\n\r\nfunction detachTracker(node: ElementWithValueTracker) {\r\n  node._valueTracker = null;\r\n}\r\n\r\nfunction getValueFromNode(node: HTMLInputElement): string {\r\n  let value = '';\r\n  if (!node) {\r\n    return value;\r\n  }\r\n\r\n  if (isCheckable(node)) {\r\n    value = node.checked ? 'true' : 'false';\r\n  } else {\r\n    value = node.value;\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\nfunction trackValueOnNode(node: any): ?ValueTracker {\r\n  const valueField = isCheckable(node) ? 'checked' : 'value';\r\n  const descriptor = Object.getOwnPropertyDescriptor(\r\n    node.constructor.prototype,\r\n    valueField,\r\n  );\r\n\r\n  if (__DEV__) {\r\n    checkFormFieldValueStringCoercion(node[valueField]);\r\n  }\r\n  let currentValue = '' + node[valueField];\r\n\r\n  // if someone has already defined a value or Safari, then bail\r\n  // and don't track value will cause over reporting of changes,\r\n  // but it's better then a hard failure\r\n  // (needed for certain tests that spyOn input values and Safari)\r\n  if (\r\n    node.hasOwnProperty(valueField) ||\r\n    typeof descriptor === 'undefined' ||\r\n    typeof descriptor.get !== 'function' ||\r\n    typeof descriptor.set !== 'function'\r\n  ) {\r\n    return;\r\n  }\r\n  const {get, set} = descriptor;\r\n  Object.defineProperty(node, valueField, {\r\n    configurable: true,\r\n    get: function() {\r\n      return get.call(this);\r\n    },\r\n    set: function(value) {\r\n      if (__DEV__) {\r\n        checkFormFieldValueStringCoercion(value);\r\n      }\r\n      currentValue = '' + value;\r\n      set.call(this, value);\r\n    },\r\n  });\r\n  // We could've passed this the first time\r\n  // but it triggers a bug in IE11 and Edge 14/15.\r\n  // Calling defineProperty() again should be equivalent.\r\n  // https://github.com/facebook/react/issues/11768\r\n  Object.defineProperty(node, valueField, {\r\n    enumerable: descriptor.enumerable,\r\n  });\r\n\r\n  const tracker = {\r\n    getValue() {\r\n      return currentValue;\r\n    },\r\n    setValue(value) {\r\n      if (__DEV__) {\r\n        checkFormFieldValueStringCoercion(value);\r\n      }\r\n      currentValue = '' + value;\r\n    },\r\n    stopTracking() {\r\n      detachTracker(node);\r\n      delete node[valueField];\r\n    },\r\n  };\r\n  return tracker;\r\n}\r\n\r\nexport function track(node: ElementWithValueTracker) {\r\n  if (getTracker(node)) {\r\n    return;\r\n  }\r\n\r\n  // TODO: Once it's just Fiber we can move this to node._wrapperState\r\n  node._valueTracker = trackValueOnNode(node);\r\n}\r\n\r\nexport function updateValueIfChanged(node: ElementWithValueTracker) {\r\n  if (!node) {\r\n    return false;\r\n  }\r\n\r\n  const tracker = getTracker(node);\r\n  // if there is no tracker at this point it's unlikely\r\n  // that trying again will succeed\r\n  if (!tracker) {\r\n    return true;\r\n  }\r\n\r\n  const lastValue = tracker.getValue();\r\n  const nextValue = getValueFromNode(node);\r\n  if (nextValue !== lastValue) {\r\n    tracker.setValue(nextValue);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function stopTracking(node: ElementWithValueTracker) {\r\n  const tracker = getTracker(node);\r\n  if (tracker) {\r\n    tracker.stopTracking();\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}